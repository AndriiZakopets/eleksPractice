{"ast":null,"code":"import _objectSpread from \"C:\\\\prog\\\\eleksPractice\\\\moviesapp\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";\nimport _slicedToArray from \"C:\\\\prog\\\\eleksPractice\\\\moviesapp\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"C:\\\\prog\\\\eleksPractice\\\\moviesapp\\\\src\\\\components\\\\Catalog.js\";\nimport React, { useEffect, useState, useCallback } from 'react';\nimport debounce from 'lodash/debounce';\nimport API from '../API';\nimport Filters from './Filters';\nimport ListItem from './ListItem';\nconst TRENDING = 'trending';\nconst POPULAR = 'popular';\nconst TOP = 'top';\nconst REQUEST_MAP = {\n  [TRENDING]: API.getTrending,\n  [POPULAR]: API.getPopular,\n  [TOP]: API.getTopRated\n};\n\nfunction Catalog({\n  history,\n  changeCacheData\n}) {\n  ;\n\n  const _useState = useState([]),\n        _useState2 = _slicedToArray(_useState, 2),\n        data = _useState2[0],\n        setData = _useState2[1];\n\n  const _useState3 = useState({\n    sorting: localStorage.getItem('sorting') || 'trending',\n    page: localStorage.getItem('page') || 1,\n    totalPages: 0,\n    searchQuery: ''\n  }),\n        _useState4 = _slicedToArray(_useState3, 2),\n        settings = _useState4[0],\n        setSettings = _useState4[1];\n\n  const changeSettings = (newSettings = {}) => {\n    setSettings(prevState => _objectSpread({}, prevState, {\n      page: 1\n    }, newSettings));\n  };\n\n  const changeSettingsDebounced = debounce(changeSettings, 400);\n  const getRequestFunc = useCallback(() => {\n    const searchQuery = settings.searchQuery,\n          sorting = settings.sorting,\n          page = settings.page;\n    const requestFunc = searchQuery.trim() ? API.getMovieByQuery.bind(null, page, searchQuery) : REQUEST_MAP[sorting].bind(null, page);\n    return requestFunc; // .then(({ results }) => setData(results))\n    // .catch(alert);\n  }, [settings]);\n  const addCacheData = useCallback(() => {\n    const additionData = {};\n    data.forEach(dataItem => {\n      additionData[dataItem.id] = dataItem;\n    });\n    changeCacheData(additionData);\n  }, [data, changeCacheData]);\n  useEffect(() => {\n    const requestFunc = getRequestFunc();\n    requestFunc().then(({\n      total_pages,\n      results\n    }) => {\n      setData(results);\n      setTotalPages(total_pages);\n    });\n  }, [getRequestFunc]);\n  useEffect(() => {\n    localStorage.setItem('page', settings.page);\n    localStorage.setItem('sorting', settings.sorting);\n  }, [settings]);\n  useEffect(() => {\n    addCacheData();\n  }, [addCacheData]);\n  return React.createElement(\"div\", {\n    className: \"Catalog\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 78\n    },\n    __self: this\n  }, React.createElement(Filters, {\n    settings: settings,\n    changeSettings: changeSettings,\n    changeSettingsDebounced: changeSettingsDebounced,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 79\n    },\n    __self: this\n  }), React.createElement(\"div\", {\n    className: \"list\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 84\n    },\n    __self: this\n  }, data.map(movie => React.createElement(ListItem, {\n    movie: movie,\n    key: movie.id,\n    history: history,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 87\n    },\n    __self: this\n  }))));\n}\n\nexport default Catalog;","map":{"version":3,"sources":["C:/prog/eleksPractice/moviesapp/src/components/Catalog.js"],"names":["React","useEffect","useState","useCallback","debounce","API","Filters","ListItem","TRENDING","POPULAR","TOP","REQUEST_MAP","getTrending","getPopular","getTopRated","Catalog","history","changeCacheData","data","setData","sorting","localStorage","getItem","page","totalPages","searchQuery","settings","setSettings","changeSettings","newSettings","prevState","changeSettingsDebounced","getRequestFunc","requestFunc","trim","getMovieByQuery","bind","addCacheData","additionData","forEach","dataItem","id","then","total_pages","results","setTotalPages","setItem","map","movie"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useCallback } from 'react';\r\nimport debounce from 'lodash/debounce';\r\nimport API from '../API'\r\nimport Filters from './Filters'\r\nimport ListItem from './ListItem';\r\n\r\nconst TRENDING = 'trending';\r\nconst POPULAR = 'popular';\r\nconst TOP = 'top';\r\n\r\nconst REQUEST_MAP = {\r\n  [TRENDING]: API.getTrending,\r\n  [POPULAR]: API.getPopular,\r\n  [TOP]: API.getTopRated\r\n}\r\n\r\nfunction Catalog({ history, changeCacheData }) {;\r\n  const [data, setData] = useState([]);\r\n  const [settings, setSettings] = useState({\r\n    sorting: localStorage.getItem('sorting') || 'trending',\r\n    page: localStorage.getItem('page') || 1,\r\n    totalPages: 0,\r\n    searchQuery: ''\r\n  });\r\n\r\n  const changeSettings = (newSettings = {}) => {\r\n    setSettings(prevState => ({\r\n      ...prevState,\r\n      page: 1,\r\n      ...newSettings\r\n    }));\r\n  }\r\n\r\n  const changeSettingsDebounced = debounce(changeSettings, 400);\r\n\r\n  const getRequestFunc = useCallback(() => {\r\n    const { searchQuery, sorting, page } = settings;\r\n    const requestFunc = (searchQuery.trim()) ? \r\n    API.getMovieByQuery.bind(null, page, searchQuery) : \r\n    REQUEST_MAP[sorting].bind(null, page);\r\n\r\n    return requestFunc;\r\n    // .then(({ results }) => setData(results))\r\n    // .catch(alert);\r\n  }, [settings]);\r\n\r\n\r\n  const addCacheData = useCallback(() => {\r\n    const additionData = {};\r\n\r\n    data.forEach(dataItem => {\r\n      additionData[dataItem.id] = dataItem;\r\n    });\r\n\r\n    changeCacheData(additionData);\r\n  }, [data, changeCacheData]);\r\n  \r\n  useEffect(() => {\r\n    const requestFunc = getRequestFunc();\r\n\r\n    requestFunc()\r\n    .then(({total_pages, results}) => {\r\n      setData(results);\r\n      setTotalPages(total_pages);\r\n    })\r\n  }, [getRequestFunc]);\r\n\r\n  useEffect(() => {\r\n    localStorage.setItem('page', settings.page);\r\n    localStorage.setItem('sorting', settings.sorting);\r\n  }, [settings]);\r\n\r\n  useEffect(() => {\r\n    addCacheData();\r\n  }, [addCacheData]);\r\n\r\n  return (\r\n    <div className=\"Catalog\">\r\n      <Filters \r\n        settings={settings} \r\n        changeSettings={changeSettings}\r\n        changeSettingsDebounced={changeSettingsDebounced}\r\n      />\r\n      <div className=\"list\">\r\n        {\r\n          data.map(movie => (\r\n            <ListItem\r\n              movie={movie}\r\n              key={movie.id}\r\n              history={history}\r\n            />\r\n          ))\r\n        }\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Catalog;"]},"metadata":{},"sourceType":"module"}